<!DOCTYPE html>
<html>
<head>
	<title></title>

<script src="https://www.gstatic.com/firebasejs/5.10.1/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyBgej8wRzG-5J4vZNDP_nku75OlhAUhetM",
    authDomain: "webv-cb0d0.firebaseapp.com",
    databaseURL: "https://webv-cb0d0.firebaseio.com",
    projectId: "webv-cb0d0",
    storageBucket: "webv-cb0d0.appspot.com",
    messagingSenderId: "612538720203"
  };
  firebase.initializeApp(config);
  var username,login=false;
  x=0;
  y=0;
  
  function logins(){
  	username=document.getElementById("name").value;
  	login=true;
  	console.log(username);
  	ref=firebase.database().ref("main/"+username);
  	ref.set({player:username,x:x,y:y});
  	document.getElementById("main").style.display="block";
  	document.getElementById("login").style.display="none";
  	ref=firebase.database().ref("main");
    console.log("connect");
  }



</script>
<style>
#canvas{
	border:1px solid #ddd;
}
#main{
  display:none;
}
#login{
	display: block;
}
</style>
</head>
<body>
<div id="login">
	<input type="text" name="" id="name"><button onclick="logins()">ตกลง</button>
</div>
<div id="main">
	<canvas id="canvas" width="900" height="900">
	</canvas>
</div>
<script>
var ctx=document.getElementById("canvas").getContext("2d");
var img=new  Image();
var img2=new Array();
var positionX=new Array();
var positionY=new Array();
login=false;
function connect(image,id){
  for(i=-1;i<=id;i++){
    img2[i]=new Image();
  }
  
  //let y=img2[id];
  img2[id].onload=function(){
  //ctx.drawImage(img,0,0,100,100);
  for(i=-1;i<=id;i++){
    ctx.drawImage(img2[i],positionX[i],positionY[i],100,100);
  }
     }
//img.src="bg.jpg";
for(i=-1;i<=id;i++){
    img2[i].src=image;
  }

console.log("ss");
}



ref=firebase.database().ref("main");
  ref.on("value",function(snapshot){
  	if(snapshot.val()!=null && login==true){
  		img.onload=function(){
        ctx.drawImage(img,0,0,800,800);
      }
      img.src="https://pbs.twimg.com/profile_images/673147737974542336/_wfv-NzO_400x400.jpg";
  		let id=-1;
  		snapshot.forEach(function(data){
  			id+=1;
  			data.forEach(function(ingame){
  				
  				if(ingame.key=="x"){
  					console.log("x "+ingame.val());
            positionX[id]=ingame.val();
  				}else if(ingame.key=="y"){
  					console.log("y "+ingame.val());
            positionY[id]=ingame.val();
  				}else if(ingame.key=="player"){
  					console.log("player "+ingame.val());
  				}
  			});
  			console.log("x : "+x+" y : "+y);

      connect("https://image.fnbr.co/outfit/5ab155f4e9847b3170da0321/png.png",id);
  		});
  	}

  },function(err){

  });
  document.addEventListener("keydown",function(e){
if(login){

    if(e.key=="a" ){
      x-=10;
    }else if(e.key=="d"){
      x+=10;
    }else if(e.key=="w"){
      y-=10;
    }else if(e.key=="s"){
      y+=10;
    }
    ref=firebase.database().ref("main/"+username);
    ref.set({player:username,x:x,y:y});
}
  });
</script>
</body>
</html>
